(function(){var a=this,b=a.ko;if(typeof b=="undefined")throw"knockoutJS must be loaded to use KnockoutApp";var c=a.KnockoutApp={};c.VERSION="0.1.0";var d=c.Utils={isObservableArray:function(a){return b.isObservable(a)&&a.destroyAll!==undefined},extendObjKnockout:function(a,c){for(var e in c){var f=c[e];typeof f=="object"&&f!==null&&a[e]&&!b.isWriteableObservable(a[e])?d.extendObjKnockout(a[e],f):d.isObservableArray(a[e])?f instanceof Array?a[e](f):a[e].push(f):b.isWriteableObservable(a[e])?a[e](f):a[e]=f}return a},extendClass:function(a,c){var d=this,e=function(){},f;return a&&a.hasOwnProperty("constructor")?f=a.constructor:f=function(){d.apply(this,arguments)},b.utils.extend(f,d),e.prototype=d.prototype,f.prototype=new e,a&&b.utils.extend(f.prototype,a),c&&b.utils.extend(f,c),f.prototype.constructor=f,f.__super__=d.prototype,f.extend=d.extend,f},unwrapValue:function(a){return typeof a=="function"?a():a},wrapError:function(){var a=Array.prototype.slice.call(arguments);console.log("Error",a)}},e=c.Model=function(a,c){this.id=b.observable(!1),this.attributes={},a&&(a.id&&(this.id(a.id),delete a.id),this.attributes=d.extendObjKnockout(this.defaultAttributes(),a)),c&&(this.collection=c),this.isNew=b.computed(function(){return this.id()===!1?!0:!1},this),this.initialize&&this.initialize.apply(this,arguments)};b.utils.extend(e.prototype,{defaultAttributes:function(){return{}},url:function(){var a=this.baseUrl||this.collection.url;return this.isNew()?a:a+(a[a.length-1]==="/"?"":"/")+this.id()},validate:function(){return!0},fetch:function(a){var e=this,f={};return f.succes=function(a){delete a.id,e.attributes=d.extendObjKnockout(e.defaultAttributes(),a)},f.error=function(){d.wrapError(arguments)},a&&b.utils.extend(f,a),(this.sync||this.collection&&this.collection.sync||c.Sync).call(this,"fetch",this,f)},save:function(a){if(this.validate()!==!0)return!1;var e=this,f={},g=this.isNew()?"create":"update";return f.success=function(a){g==="create"&&e.id(a.id)},f.error=function(){d.wrapError(arguments)},a&&b.utils.extend(f,a),(this.sync||this.collection&&this.collection.sync||c.Sync).call(this,g,this,f)},destroy:function(a){if(this.isNew()&&this.collection)this.collection.models.remove(this);else if(!this.isNew()){var e={},f=this;return e.success=function(a){f.collection&&f.collection.models.remove(f)},e.error=function(){d.wrapError(arguments)},a&&b.utils.extend(e,a),(this.sync||this.collection&&this.collection.sync||c.Sync).call(this,"destroy",this,e)}},toJSON:function(){var a=b.toJS(this.attributes);return a.id=this.id(),a}});var f=c.Collection=function(a){if(!a)throw"A model must be provided for a collection";this.model=a,this.models=b.observableArray(),this.initialize&&this.initialize.apply(this,arguments)};b.utils.extend(f.prototype,{fetch:function(a){var e=this,f={};return f.success=function(a){var b=[];for(model in a)b.push(a[model]);b.length>0&&e.add(b)},f.error=function(){d.wrapError(arguments)},f&&b.utils.extend(f,a),(this.sync||c.Sync).call(this,"fetch",this,f)},add:function(a,c){var d=a instanceof Array?a:[a],e=this;b.utils.arrayForEach(d,function(a){var b=new e.model(a,e);e.models.push(b),c&&b.save()})},remove:function(a){var c=a instanceof Array?a:[a];b.utils.arrayForEach(c,function(a){a.destroy()})},toJSON:function(){var a=[];return b.utils.arrayForEach(this.models(),function(b){a.push(b.toJSON())}),a}}),c.Sync=function(c,e,f){if(typeof a.$=="undefined")throw"jQuery is necessary to make Ajax calls";var g={},h=f||{};param.dataType="json",g.url=d.unwrapValue(e.url);switch(c){case"fetch":g.type="GET";break;case"create":g.type="POST",e.modelName?(g.data={},g.data[e.modelName]=e.toJSON()):g.data=e.toJSON();break;case"update":g.type="PUT",e.modelName?(g.data={},g.data[e.modelName]=e.toJSON()):g.data=e.toJSON();break;case"destroy":g.type="DELETE"}return a.$.ajax(b.utils.extend(g,h))},f.extend=e.extend=d.extendClass}).call(this);