/*! Knockout App - v0.2.5 - 2014-06-27
* https://github.com/paglias/KnockoutApp
* Copyright (c) 2014 Matteo Pagliazzi; Licensed MIT */

(function(t,e){if("undefined"!=typeof exports){var i;i=void 0!==typeof module?module.exports:exports,e(i,require("knockout"),require("jquery"))}else"function"==typeof define&&define.amd?define(["exports","knockout","jquery"],function(i,n,r){t.KnockoutApp=e(i,n,r)}):t.KnockoutApp=e({},t.ko,t.jQuery)})(this,function(t,e,i){if(e===void 0)throw"KnockoutJS must be loaded to use KnockoutApp";t.VERSION="0.2.5";var n=t.Utils={isObservableArray:function(t){return e.isObservable(t)&&void 0!==t.destroyAll},extendObjKnockout:function(t,i){for(var r in i){var s=i[r];"object"==typeof s&&null!==s&&t[r]&&!e.isWriteableObservable(t[r])?n.extendObjKnockout(t[r],s):n.isObservableArray(t[r])?s instanceof Array?t[r](s):t[r].push(s):e.isWriteableObservable(t[r])?t[r](s):t[r]=s}return t},cloneObjKnockout:function(t){if(e.isWriteableObservable(t))return e.observable(t());if(null===t||"object"!=typeof t)return t;var i=t.constructor();for(var r in t)i[r]=n.cloneObjKnockout(t[r]);return i},extendClass:function(t,i){var n,r=this,s=function(){};return n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){r.apply(this,arguments)},e.utils.extend(n,r),s.prototype=r.prototype,n.prototype=new s,t&&e.utils.extend(n.prototype,t),i&&e.utils.extend(n,i),n.prototype.constructor=n,n.__super__=r.prototype,n},unwrapValue:function(t,e){if(null===t)return null;var i=t[e];return"function"==typeof i?i.call(t):i}},r=t.Model=function(t,i){if(this.id=e.observable(!1),this.attributes={},t){t[this.idAttribute]&&(this.id(t[this.idAttribute]),delete t[this.idAttribute]);var r=n.cloneObjKnockout(this.defaults);this.attributes=n.extendObjKnockout(r,t)}else this.attributes=n.cloneObjKnockout(this.defaults);i&&i.collection&&(this.collection=i.collection),this.isNew=e.computed(function(){return this.id()===!1?!0:!1},this),this.initialize&&this.initialize.apply(this,arguments)};e.utils.extend(r.prototype,{defaults:{},idAttribute:"id",sync:function(){return(this.collection&&this.collection.sync||t.Sync).apply(this,arguments)},url:function(){var t=n.unwrapValue(this,"baseUrl")||this.collection&&n.unwrapValue(this.collection,"url");if(void 0===typeof t)throw"Missing baseUrl or collection.url properties";return this.isNew()?t:t+("/"===t[t.length-1]?"":"/")+this.id()},validate:function(){return!0},fetch:function(t){var e=this,i=t||{},r=i.success;return i.success=function(t){delete t[e.idAttribute];var i=n.cloneObjKnockout(e.defaults);e.attributes=n.extendObjKnockout(i,t),r&&r(e,t)},this.sync.call(this,"fetch",this,i)},save:function(t){if(this.validate()!==!0)return!1;var e=this,i=t||{},n=i.success,r=this.isNew()?"create":"update";return i.success=function(t){"create"===r&&e.id(t[e.idAttribute]),n&&n(e,t)},this.sync.call(this,r,this,i)},destroy:function(t){var e=this,i=t||{},n=i.success;if(i.success=function(){e.collection&&(e.collection.models.remove(e),delete e.collection),n&&n(e,data)},this.isNew())return i.success(),!1;var r=this.sync.call(this,"destroy",this,i);return i.wait||(i.success(),delete i.success),r},toJSON:function(){var t=e.toJS(this.attributes);return this.id()&&(t[this.idAttribute]=this.id()),t}});var s=t.Collection=function(t){this.models=e.observableArray(),t&&this.add(t),this.initialize&&this.initialize.apply(this,arguments)};return e.utils.extend(s.prototype,{model:r,sync:function(){return t.Sync.apply(this,arguments)},add:function(t,i,n){var s=t instanceof Array?t:[t],o=this;e.utils.arrayForEach(s,function(t){var e;t instanceof r?(e=t,e.collection=o):e=new o.model(t,{collection:o}),o.models.push(e),i&&e.save(n)})},reset:function(){e.utils.arrayForEach(this.models(),function(t){t.collection=void 0}),this.models([])},fetch:function(t){var e=this,i=t||{},n=i.success;return i.success=function(t){var i=[];for(var r in t)i.push(t[r]);e.reset(),i.length>0&&e.add(i),n&&n(e,t)},this.sync.call(this,"fetch",this,i)},remove:function(t,i){var n=t instanceof Array?t:[t];e.utils.arrayForEach(n,function(t){t.destroy(i)})},find:function(t){return t?e.utils.arrayFirst(this.models(),function(i){if("object"!=typeof t)return i.id()===t?!0:!1;var n=!0;for(var r in t)if(e.utils.unwrapObservable(i.attributes[r])!==t[r]){n=!1;break}return n}):!1},where:function(t){return t?e.utils.arrayFilter(this.models(),function(i){var n=!0;for(var r in t){if(i.idAttribute===r&&i.id()!==t[r]){n=!1;break}if(e.utils.unwrapObservable(i.attributes[r])!==t[r]){n=!1;break}}return n}):[]},toJSON:function(){var t=[];return e.utils.arrayForEach(this.models(),function(e){t.push(e.toJSON())}),t}}),t.Sync=function(t,r,s){if(i===void 0)throw"jQuery is necessary to make Ajax calls";var o={},u=s||{};if(o.dataType="json",o.url=n.unwrapValue(r,"url"),!o.url)throw"Url property must be defined in model/collection when using KnockoutApp.Sync";switch(t){case"fetch":o.type="GET";break;case"create":o.type="POST",r.name?(o.data={},o.data[r.name]=r.toJSON()):o.data=r.toJSON();break;case"update":o.type="PUT",r.name?(o.data={},o.data[r.name]=r.toJSON()):o.data=r.toJSON();break;case"destroy":o.type="DELETE"}return i.ajax(e.utils.extend(o,u))},s.extend=r.extend=n.extendClass,t});